\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
  \newcommand{\euro}{€}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\PassOptionsToPackage{usenames,dvipsnames}{color} % color is loaded by hyperref
\hypersetup{unicode=true,
            pdftitle={Coletando dados financeiros},
            pdfauthor={Lucca Simeoni Pavan  João Carlos de Carvalho},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{{#1}}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{{#1}}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\ImportTok}[1]{{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{{#1}}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{{#1}}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{{#1}}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{{#1}}}}
\newcommand{\BuiltInTok}[1]{{#1}}
\newcommand{\ExtensionTok}[1]{{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{{#1}}}
\newcommand{\RegionMarkerTok}[1]{{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\NormalTok}[1]{{#1}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Coletando dados financeiros}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Lucca Simeoni Pavan \hspace{1cm} João Carlos de Carvalho}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{\today}


\setlength\parindent{24pt}
\usepackage[english, brazil]{babel}

% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr::opts_chunk$}\KeywordTok{set}\NormalTok{(}\DataTypeTok{echo =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{cache =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{warning =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{message =} \OtherTok{FALSE}\NormalTok{, }
    \DataTypeTok{error =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{tidy =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{tidy.opts =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{width.cutoff =} \DecValTok{70}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{Coletando dados usando o pacote
\texttt{GetHFData}}{Coletando dados usando o pacote GetHFData}}\label{coletando-dados-usando-o-pacote-gethfdata}

Os dados podem ser coletados usando o pacote \texttt{GetHFData}
desenvolvido por Perlin (2016). Para maiores detalhes sobre o pacote
veja também Perlin and Ramos (2016). Primeiramente baixaremos os
\emph{layouts} da base de dados usando o comando
\texttt{gthf\_download\_file}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(GetHFData)}
\NormalTok{layout_negocios <-}\StringTok{ "ftp://ftp.bmf.com.br/MarketData/NEG_LAYOUT_portuguese.txt"}
\KeywordTok{ghfd_download_file}\NormalTok{(layout_negocios, }\DataTypeTok{out.file =} \StringTok{"layout_negocios"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Attempt 1 - File exists, skipping dl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{layout_oferta_compra <-}\StringTok{ "ftp://ftp.bmf.com.br/MarketData/OFER_CPA_LAYOUT_portuguese.txt"}
\KeywordTok{ghfd_download_file}\NormalTok{(layout_oferta_compra, }\DataTypeTok{out.file =} \StringTok{"layout_oferta_compra"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Attempt 1 - File exists, skipping dl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{layout_oferta_venda <-}\StringTok{ "ftp://ftp.bmf.com.br/MarketData/OFER_VDA_LAYOUT_portuguese.txt"}
\KeywordTok{ghfd_download_file}\NormalTok{(layout_oferta_venda, }\DataTypeTok{out.file =} \StringTok{"layout_oferta_venda"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Attempt 1 - File exists, skipping dl
\end{verbatim}

\texttt{Attempt\ 1} e \texttt{TRUE} significam que o download na
primeira tentativa foi realizado com sucesso. A mensagem
\texttt{File\ exists,\ skipping\ dl} aparece quando o comando for
acionado pela segunda vez e portanto o documento já foi baixado. Os
arquivos de \emph{layout} podem ser abertos pelo bloco de notas.

O comando \texttt{ghfd\_get\_ftp\_contents} acessa o ftp da Bovespa e
retorna um vetor com todos os arquivos relacionadosm à negócios (todos
os outros são ignorados).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"GetHFData"}\NormalTok{)}
\NormalTok{contents_equity <-}\StringTok{ }\KeywordTok{ghfd_get_ftp_contents}\NormalTok{(}\DataTypeTok{type.market =} \StringTok{"equity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reading ftp contents for equity (attempt = 1|10)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{contents_options <-}\StringTok{ }\KeywordTok{ghfd_get_ftp_contents}\NormalTok{(}\DataTypeTok{type.market =} \StringTok{"options"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reading ftp contents for options (attempt = 1|10)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{contents_bmf <-}\StringTok{ }\KeywordTok{ghfd_get_ftp_contents}\NormalTok{(}\DataTypeTok{type.market =} \StringTok{"BMF"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reading ftp contents for BMF (attempt = 1|10)
\end{verbatim}

Usando os comandos \texttt{head} e \texttt{tail} podemos ver os 6
primeiros e 6 últimos elementos dos arquivos baixados anteriormente.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(contents_equity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              files      dates
## 1 NEG_20141103.zip 2014-11-03
## 2 NEG_20141104.zip 2014-11-04
## 3 NEG_20141105.zip 2014-11-05
## 4 NEG_20141106.zip 2014-11-06
## 5 NEG_20141107.zip 2014-11-07
## 6 NEG_20141110.zip 2014-11-10
##                                                             link
## 1 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141103.zip
## 2 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141104.zip
## 3 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141105.zip
## 4 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141106.zip
## 5 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141107.zip
## 6 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20141110.zip
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(contents_equity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                files      dates
## 462 NEG_20160823.zip 2016-08-23
## 463 NEG_20160824.zip 2016-08-24
## 464 NEG_20160825.zip 2016-08-25
## 465 NEG_20160826.zip 2016-08-26
## 466 NEG_20160829.zip 2016-08-29
## 467 NEG_20160830.zip 2016-08-30
##                                                               link
## 462 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160823.zip
## 463 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160824.zip
## 464 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160825.zip
## 465 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160826.zip
## 466 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160829.zip
## 467 ftp://ftp.bmf.com.br/marketdata/Bovespa-Vista/NEG_20160830.zip
\end{verbatim}

O primeiro dia disponível para o mercado de ações (\emph{equity}) é
2014-11-03 e o último é 2016-08-30. Os arquivos \texttt{.zip} armazenam
dados das transações diárias e obviamente somente de segunda à
sexta-feira.

Para sabermos os \emph{tickers} (nomes dos ativos transacionados, ex.
para o mercado de ações \texttt{PETR4}, é um \emph{ticker} para ações da
PETROBRAS) podemos usar o comando
\texttt{ghfd\_get\_available\_tickers\_from\_file} que obtém os
\emph{tickers} disponíveis de um arquivo baixado do ftp da Bovespa ou
podemos usar o comando \texttt{ghfd\_get\_available\_tickers\_from\_ftp}
que obtém os \emph{tickers} disponíveis em um mercado e uma data
específicos. Os dois comandos apresentam como resultado um vetor
numérico com os tickers e outro com o número de transações de cada
\emph{ticker}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tickers_equity <-}\StringTok{ }\KeywordTok{ghfd_get_available_tickers_from_ftp}\NormalTok{(}\DataTypeTok{my.date =} \StringTok{"2015-11-03"}\NormalTok{, }
    \DataTypeTok{type.market =} \StringTok{"equity"}\NormalTok{, }\DataTypeTok{max.dl.tries =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reading ftp contents for equity (attempt = 1|10) Attempt 1 - File exists, skipping dl
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(tickers_equity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   tickers n.trades                     f.name
## 1   PETR4    52231 ftp files/NEG_20151103.zip
## 2   ITUB4    50437 ftp files/NEG_20151103.zip
## 3   BVMF3    47214 ftp files/NEG_20151103.zip
## 4   VALE5    41959 ftp files/NEG_20151103.zip
## 5   BBDC4    39403 ftp files/NEG_20151103.zip
## 6   ITSA4    37993 ftp files/NEG_20151103.zip
\end{verbatim}

Existem 419 \emph{tickers} para o mercado de ações na data especificada.

Para baixar os dados de transações de alta frequência e agregá-los para
análise usamos o comando \texttt{ghfd\_get\_HF\_data}. Para exemplo
usarei os três \emph{tickers} mais comercializados no mercado de ações
em 03/11/2015, coletados no período de 30/06/2016 a 30/08/2016.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados_top3 <-}\StringTok{ }\KeywordTok{ghfd_get_HF_data}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"PETR4"}\NormalTok{, }\StringTok{"ITUB4"}\NormalTok{, }\StringTok{"BVMF3"}\NormalTok{), }\DataTypeTok{type.market =} \StringTok{"equity"}\NormalTok{, }
    \DataTypeTok{first.date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{"2016-06-30"}\NormalTok{), }\DataTypeTok{last.date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{"2016-08-30"}\NormalTok{), }
    \DataTypeTok{first.time =} \StringTok{"9:00:00"}\NormalTok{, }\DataTypeTok{last.time =} \StringTok{"18:00:00"}\NormalTok{, }\DataTypeTok{type.output =} \StringTok{"agg"}\NormalTok{, }
    \DataTypeTok{agg.diff =} \StringTok{"1 hour"}\NormalTok{, }\DataTypeTok{dl.dir =} \StringTok{"ftp files"}\NormalTok{, }\DataTypeTok{max.dl.tries =} \DecValTok{10}\NormalTok{, }\DataTypeTok{clean.files =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{load}\NormalTok{(}\StringTok{"dados_top3.Rda"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(dados_top3, }\DataTypeTok{n =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   InstrumentSymbol SessionDate       TradeDateTime n.trades last.price
## 1            BVMF3  2016-06-30 2016-06-30 10:00:00     2992      17.63
## 2            BVMF3  2016-06-30 2016-06-30 11:00:00     3642      17.67
## 3            BVMF3  2016-06-30 2016-06-30 12:00:00     2289      17.72
##   weighted.price  period.ret period.ret.volat sum.qtd  sum.vol n.buys
## 1       17.53706 0.021436848     0.0003225179 1523500 26716617   1238
## 2       17.62966 0.001700680     0.0003044433 1200900 21171287   1395
## 3       17.68812 0.002829655     0.0003512668 1156900 20463311   1079
##   n.sells Tradetime
## 1    1754  10:00:00
## 2    2247  11:00:00
## 3    1210  12:00:00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(dados_top3, }\DataTypeTok{n =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      InstrumentSymbol SessionDate       TradeDateTime n.trades last.price
## 1054            PETR4  2016-08-30 2016-08-30 15:00:00     4943      13.02
## 1055            PETR4  2016-08-30 2016-08-30 16:00:00     5006      13.06
## 1056            PETR4  2016-08-30 2016-08-30 17:00:00      489      13.15
##      weighted.price   period.ret period.ret.volat sum.qtd   sum.vol n.buys
## 1054       13.02425 -0.003062787     0.0003166287 4252300  55382934   1635
## 1055       13.02341  0.003072197     0.0003043510 5535600  72092146   2506
## 1056       13.09081  0.004583652     0.0003054307 9056300 118554268    184
##      n.sells Tradetime
## 1054    3308  15:00:00
## 1055    2500  16:00:00
## 1056     305  17:00:00
\end{verbatim}

Por fim o comando \texttt{ghfd\_read\_file} baixa os dados na sua forma
bruta, ou seja apenas lê o arquivo \texttt{.zip} baixado do ftp da
Bovespa. Nesta opção fica disponível o código da corretora que efetuou a
transação.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"GetHFData"}\NormalTok{)}
\NormalTok{path <-}\StringTok{ }\KeywordTok{path.expand}\NormalTok{(}\StringTok{"~/artigo_macroeconometria_lucca_joao/ftp files/NEG_20160830.zip"}\NormalTok{)}
\NormalTok{dados_bruto <-}\StringTok{ }\KeywordTok{ghfd_read_file}\NormalTok{(}\DataTypeTok{out.file =} \NormalTok{path, }\DataTypeTok{my.assets =} \OtherTok{NULL}\NormalTok{, }\DataTypeTok{first.time =} \StringTok{"10:00:00"}\NormalTok{, }
    \DataTypeTok{last.time =} \StringTok{"17:00:00"}\NormalTok{, }\DataTypeTok{type.output =} \StringTok{"raw"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  - Imported  713224 lines, 475 unique tickers
##    -> Processing file - Found 713224 lines, 475 unique tickers
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(dados_bruto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 10
##   SessionDate InstrumentSymbol TradePrice TradedQuantity    Tradetime
##        <date>            <chr>      <dbl>          <dbl>        <chr>
## 1  2016-08-30           AALC34      32.81            800 16:10:39.669
## 2  2016-08-30           AAPL34      34.50           3600 16:05:22.618
## 3  2016-08-30           AAPL34      34.15           8700 16:10:39.669
## 4  2016-08-30           ABCB10      14.21            500 10:00:57.694
## 5  2016-08-30           ABCB10      14.00           1000 15:01:20.909
## 6  2016-08-30           ABCB10      14.00            400 15:15:49.496
## # ... with 5 more variables: CrossTradeIndicator <int>, BuyMember <dbl>,
## #   SellMember <dbl>, TradeDateTime <time>, TradeSign <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(dados_bruto)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 10
##   SessionDate InstrumentSymbol TradePrice TradedQuantity    Tradetime
##        <date>            <chr>      <dbl>          <dbl>        <chr>
## 1  2016-08-30           XTED11      22.56             30 16:42:14.335
## 2  2016-08-30           XTED11      22.52             85 16:42:14.335
## 3  2016-08-30           XTED11      22.57            500 16:42:14.335
## 4  2016-08-30           XTED11      22.52              3 16:42:14.335
## 5  2016-08-30           XTED11      22.55              6 16:42:14.335
## 6  2016-08-30           XTED11      22.52            172 16:44:59.661
## # ... with 5 more variables: CrossTradeIndicator <int>, BuyMember <dbl>,
## #   SellMember <dbl>, TradeDateTime <time>, TradeSign <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(dados_bruto[, }\DecValTok{5}\NormalTok{:}\DecValTok{8}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##      Tradetime CrossTradeIndicator BuyMember SellMember
##          <chr>               <int>     <dbl>      <dbl>
## 1 16:10:39.669                   0        40         40
## 2 16:05:22.618                   1       238        238
## 3 16:10:39.669                   0        40         40
## 4 10:00:57.694                   0        58        174
## 5 15:01:20.909                   0       735        114
## 6 15:15:49.496                   0        15        114
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(dados_bruto[, }\DecValTok{9}\NormalTok{:}\DecValTok{10}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##         TradeDateTime TradeSign
##                <time>     <dbl>
## 1 2016-08-30 16:42:14        -1
## 2 2016-08-30 16:42:14        -1
## 3 2016-08-30 16:42:14        -1
## 4 2016-08-30 16:42:14        -1
## 5 2016-08-30 16:42:14        -1
## 6 2016-08-30 16:44:59        -1
\end{verbatim}

\section{\texorpdfstring{Coletando dados usando
\texttt{quantmod}}{Coletando dados usando quantmod}}\label{coletando-dados-usando-quantmod}

Dados do mercado financeiro podem ser baixados por um outro pacote
chamado \texttt{quantmod}. Este pacote baixa os dados de fontes como o
Yahoo Finance, Goole Finace e diversas outras fontes (Tsay 2012). A
forma que este pacote trabalha á diferente do pacote \texttt{GetHFData}.
Com o \texttt{quantmod} não é necessário designar objetos, pois este
pacote trabalha com objetos ocultos. Segue uma demonstração:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(quantmod)}
\KeywordTok{getSymbols}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"PETR4"}\NormalTok{, }\StringTok{"ITUB4"}\NormalTok{, }\StringTok{"BVMF3"}\NormalTok{), }\DataTypeTok{src =} \StringTok{"google"}\NormalTok{, }\DataTypeTok{env =} \KeywordTok{globalenv}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "PETR4" "ITUB4" "BVMF3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(PETR4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            PETR4.Open PETR4.High PETR4.Low PETR4.Close PETR4.Volume
## 2007-01-02      25.00      25.22     24.88       25.22     10221200
## 2007-01-03      25.08      25.20     24.00       24.35     19822400
## 2007-01-04      24.25      24.38     23.70       23.82     20910800
## 2007-01-05      23.60      24.00     22.55       23.10     24798200
## 2007-01-08      23.25      23.57     22.90       23.30     19406000
## 2007-01-09      22.98      23.20     22.30       22.76     25847800
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tail}\NormalTok{(BVMF3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            BVMF3.Open BVMF3.High BVMF3.Low BVMF3.Close BVMF3.Volume
## <NA>            18.30      19.01     18.26       18.80     11857600
## 2016-11-01      18.80      18.96     18.01       18.25     16018300
## 2016-11-03      18.20      18.33     17.70       17.72      9751600
## 2016-11-04      17.69      18.15     17.52       17.59      8132300
## 2016-11-07      17.94      18.60     17.85       18.56      9484100
## 2016-11-08      18.31      18.69        NA       18.40      6010800
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{(ITUB4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2437    5
\end{verbatim}

Podemos perceber que os dados fornecidos pelo Google Finance são diários
e iniciam em 2007, porém alguns intervalos de datas não estão
disponíveis para dados com fonte no Google Finance (provavelmente por
conflito de feriados) e os dados para ativos financeiros brasileiros até
a data de escrita deste documento só foram encontrados no Google
Finance. Realizei o comando \texttt{tail} para os demais ativos e estes
também não apresentaram as datas mais recentes. Esta base de dados
também não fornece o preço ajustado (para ativos financeiros
brasileiros) e os dados brutos com discriminação por corretora como na
seção anterior. Além disso ao utilizar o pacote \texttt{bizdays} que
estabelece os dias úteis para o mercado financeiro brasileiro com base
no caendário da AMBIMA ainda existe algum conflito entre os dias úteis
apresentados pelo Google Finance e pelo \texttt{bizdays}. Para mais
detalhes sobre o pacote \texttt{quantmod} veja Ryan (2016).

\section{Organizando a base de dados}\label{organizando-a-base-de-dados}

A partir de agora urilizarei os dados obtidos usando o pacote
\texttt{GetHFData} devido ao problema com o pacote \texttt{quantmod}
relatado anteriormente. a base de dados \texttt{dados\_top3} contém as
informações sobre os trê ativos \texttt{PETR4,\ ITUB4,\ BVMF3} no mesmo
banco de dados. Portanto temos que separar este banco de dados em três
outros arquivos cada um com informações a respeito de apenas um tipo de
ação.

Para isso podemos utilizar a função \texttt{filter()} do pacote
\texttt{dplyr}. O banco de dados \texttt{dados\_top3} possui dimensão
(1056, 13).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\NormalTok{PETR4_data <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(dados_top3, InstrumentSymbol ==}\StringTok{ "PETR4"}\NormalTok{)}
\NormalTok{BVMF3_data <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(dados_top3, InstrumentSymbol ==}\StringTok{ "BVMF3"}\NormalTok{)}
\NormalTok{ITUB4_data <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(dados_top3, InstrumentSymbol ==}\StringTok{ "ITUB4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Então ele será dividido em três bancos de dados de mesma dimensão (352,
13).

\subsection{Plotando os retornos dos
ativos}\label{plotando-os-retornos-dos-ativos}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(gridExtra)}
\NormalTok{plot_PETR4 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(PETR4_data, }\KeywordTok{aes}\NormalTok{(TradeDateTime, period.ret)) +}\StringTok{ }
\StringTok{    }\KeywordTok{geom_line}\NormalTok{() +}\StringTok{ }\KeywordTok{scale_x_datetime}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y-%m-%d %H:%M:%S"}\NormalTok{) +}\StringTok{ }
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) +}\StringTok{ }\KeywordTok{ylab}\NormalTok{(}\StringTok{"PETR4"}\NormalTok{) +}\StringTok{ }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{7}\NormalTok{, }
    \DataTypeTok{vjust =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.9}\NormalTok{))}
\NormalTok{plot_BVMF3 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(BVMF3_data, }\KeywordTok{aes}\NormalTok{(TradeDateTime, period.ret)) +}\StringTok{ }
\StringTok{    }\KeywordTok{geom_line}\NormalTok{() +}\StringTok{ }\KeywordTok{scale_x_datetime}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y-%m-%d %H:%M:%S"}\NormalTok{) +}\StringTok{ }
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) +}\StringTok{ }\KeywordTok{ylab}\NormalTok{(}\StringTok{"BVMF3"}\NormalTok{) +}\StringTok{ }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{7}\NormalTok{, }
    \DataTypeTok{vjust =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.9}\NormalTok{))}
\NormalTok{plot_ITUB4 <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(ITUB4_data, }\KeywordTok{aes}\NormalTok{(TradeDateTime, period.ret)) +}\StringTok{ }
\StringTok{    }\KeywordTok{geom_line}\NormalTok{() +}\StringTok{ }\KeywordTok{scale_x_datetime}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y-%m-%d %H:%M:%S"}\NormalTok{) +}\StringTok{ }
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) +}\StringTok{ }\KeywordTok{ylab}\NormalTok{(}\StringTok{"ITUB4"}\NormalTok{) +}\StringTok{ }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{7}\NormalTok{, }
    \DataTypeTok{vjust =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.9}\NormalTok{))}
\KeywordTok{grid.arrange}\NormalTok{(plot_PETR4, plot_BVMF3, plot_ITUB4, }\DataTypeTok{name =} \StringTok{"Retornos das ações"}\NormalTok{, }
    \DataTypeTok{nrow =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[h]

{\centering \includegraphics{coletando_dados_files/figure-latex/plots-1} 

}

\caption{Retornos doa ativos}\label{fig:plots}
\end{figure}

Visualente podemos perceber que os retornos oscilam em torno de zero e
que esporadicamente ocorrems valores extremos.

\section{Propriedades da distribuição dos
retornos}\label{propriedades-da-distribuicao-dos-retornos}

Para conhecermos as características da distribuição dos dados usaremos o
pacote \texttt{fBasics}. Inicialmente são apresentadas algumas
estatísticas básicas.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fBasics)}
\KeywordTok{basicStats}\NormalTok{(PETR4_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             X..PETR4_data.period.ret
## nobs                      352.000000
## NAs                         0.000000
## Minimum                    -0.026943
## Maximum                     0.028986
## 1. Quartile                -0.003815
## 3. Quartile                 0.004444
## Mean                        0.000435
## Median                      0.000000
## Sum                         0.153196
## SE Mean                     0.000388
## LCL Mean                   -0.000329
## UCL Mean                    0.001199
## Variance                    0.000053
## Stdev                       0.007287
## Skewness                    0.017503
## Kurtosis                    1.384462
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{basicStats}\NormalTok{(BVMF3_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             X..BVMF3_data.period.ret
## nobs                      352.000000
## NAs                         0.000000
## Minimum                    -0.030617
## Maximum                     0.025946
## 1. Quartile                -0.003256
## 3. Quartile                 0.003008
## Mean                       -0.000101
## Median                      0.000000
## Sum                        -0.035675
## SE Mean                     0.000337
## LCL Mean                   -0.000764
## UCL Mean                    0.000561
## Variance                    0.000040
## Stdev                       0.006322
## Skewness                   -0.058064
## Kurtosis                    2.784860
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{basicStats}\NormalTok{(ITUB4_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             X..ITUB4_data.period.ret
## nobs                      352.000000
## NAs                         0.000000
## Minimum                    -0.017962
## Maximum                     0.015730
## 1. Quartile                -0.002247
## 3. Quartile                 0.003588
## Mean                        0.000605
## Median                      0.000324
## Sum                         0.212899
## SE Mean                     0.000269
## LCL Mean                    0.000076
## UCL Mean                    0.001133
## Variance                    0.000025
## Stdev                       0.005040
## Skewness                   -0.064426
## Kurtosis                    0.967430
\end{verbatim}

Ao realizar as estatísticas básicas, percebi um problema. O cálculo do
retorno feito pelo pacote \texttt{GetHFData} é o cálculo de retorno
simples, o que torna a soma dos retornos inadequada. Para que a soma dos
retornos seja correta, o cálculo do retorno deveria ser em logarítmo, o
que possibilita a soma dos retornos. Portanto, para trabalhamors com os
retornos dos ativos, devemos calcular o logarítmo do retorno. Conforme
Tsay (2012) será utilizado o retorno ponderado pois leva em conta o
fracionamento das ações, se ocorridos no período estudado (ainda não foi
feito, os testes posteriores foram feitos com o retorno apresentado pelo
pacote).

\subsection{Teste de normalidade}\label{teste-de-normalidade}

Para testar a normalidade usarei o teste proporto por Jarque and Bera
(1987).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{normalTest}\NormalTok{(PETR4_data$period.ret, }\DataTypeTok{method =} \StringTok{"jb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Title:
##  Jarque - Bera Normalality Test
## 
## Test Results:
##   STATISTIC:
##     X-squared: 29.1554
##   P VALUE:
##     Asymptotic p Value: 4.666e-07 
## 
## Description:
##  Mon Nov 07 17:39:55 2016 by user: Lucca
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{normalTest}\NormalTok{(BVMF3_data$period.ret, }\DataTypeTok{method =} \StringTok{"jb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Title:
##  Jarque - Bera Normalality Test
## 
## Test Results:
##   STATISTIC:
##     X-squared: 116.6585
##   P VALUE:
##     Asymptotic p Value: < 2.2e-16 
## 
## Description:
##  Mon Nov 07 17:39:56 2016 by user: Lucca
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{normalTest}\NormalTok{(ITUB4_data$period.ret, }\DataTypeTok{method =} \StringTok{"jb"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Title:
##  Jarque - Bera Normalality Test
## 
## Test Results:
##   STATISTIC:
##     X-squared: 14.6224
##   P VALUE:
##     Asymptotic p Value: 0.000668 
## 
## Description:
##  Mon Nov 07 17:39:56 2016 by user: Lucca
\end{verbatim}

Para os três ativos, o teste de normalidade é rejeitado, pois os
valores-p são menores que o nível de significância, inclusive de 1\%.
Portanto, não podemos afiramr que a série possui distribuição normal.
Porém, o que realmente interessa é se o termo de erro da sequência é um
ruído branco. Para descobrirmos isso, é preciso identificar o tipo e a
ordem da série e depois realizar testes sobre o resíduo da equação de
diferenças estocástica estimada.

\section{Visualização de dados
financeiros}\label{visualizacao-de-dados-financeiros}

Para sabermos como se comportam os dados de interesse podemos plotar o
histograma dos dados e analizar o formato obtido.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{histo_PETR4 <-}\StringTok{ }\KeywordTok{hist}\NormalTok{(PETR4_data$period.ret, }\DataTypeTok{main =} \StringTok{"Retorno PETR4"}\NormalTok{, }\DataTypeTok{nclass =} \DecValTok{30}\NormalTok{)}
\NormalTok{histo_BVMF3 <-}\StringTok{ }\KeywordTok{hist}\NormalTok{(BVMF3_data$period.ret, }\DataTypeTok{main =} \StringTok{"Retorno BVMF3"}\NormalTok{, }\DataTypeTok{nclass =} \DecValTok{30}\NormalTok{)}
\NormalTok{histo_ITUB4 <-}\StringTok{ }\KeywordTok{hist}\NormalTok{(ITUB4_data$period.ret, }\DataTypeTok{main =} \StringTok{"Retorno ITUB4"}\NormalTok{, }\DataTypeTok{nclass =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[h]

{\centering \includegraphics{coletando_dados_files/figure-latex/histograma-1} 

}

\caption{Histogramas dos ativos}\label{fig:histograma}
\end{figure}

Podemos ver que o formato dos histogramas se assemelham à uma
distribuição normal, porém, como já apresentado pelo teste de
normalidade, os dados não possuem distribuição normal. Outra forma de
visualizar os dados é estimar sua densidade empírica e comparar com a
densidade de uma distribuição normal. Isto é feito por meio de um método
de suavização não paramétrico (Tsay 2012). Esta densidade empírica pode
ser vista como uma versão refinada do histograma.

A densidade normal para cada ativo foi construída usando suas
respectivas média e desvio padrão. As Figuras 2 e 3 fornecem uma
referência visual sobre a hipótese de normalidade dos retornos. AS três
densidades estimadas possuem um pico maior e caudas mais longas que a
densidade normal. Conforme Tsay (2012) isto é normal para dados
financeiros e, em geral, a diferença entre a linha pontilhada e a linha
sólida não é normalmente distribuída. O que é consistente com o teste de
normalidade realizado anteriormente.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\CommentTok{# para estimar as densidades dos retornos}
\NormalTok{dens_PETR4 <-}\StringTok{ }\KeywordTok{density}\NormalTok{(PETR4_data$period.ret)}
\NormalTok{dens_BVMF3 <-}\StringTok{ }\KeywordTok{density}\NormalTok{(BVMF3_data$period.ret)}
\NormalTok{dens_ITUB4 <-}\StringTok{ }\KeywordTok{density}\NormalTok{(ITUB4_data$period.ret)}
\KeywordTok{range}\NormalTok{(PETR4_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.02694301  0.02898551
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{range}\NormalTok{(BVMF3_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.03061728  0.02594595
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{range}\NormalTok{(ITUB4_data$period.ret)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.01796231  0.01573034
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{seq_x <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(-}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.001}\NormalTok{)  }\CommentTok{# Cria uma sequência com incremento de 0.001}
\CommentTok{# Criando uma densidade normal}
\NormalTok{norm_PETR4 <-}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(seq_x, }\KeywordTok{mean}\NormalTok{(PETR4_data$period.ret), }\KeywordTok{stdev}\NormalTok{(PETR4_data$period.ret))}
\NormalTok{norm_BVMF3 <-}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(seq_x, }\KeywordTok{mean}\NormalTok{(BVMF3_data$period.ret), }\KeywordTok{stdev}\NormalTok{(BVMF3_data$period.ret))}
\NormalTok{norm_ITUB4 <-}\StringTok{ }\KeywordTok{dnorm}\NormalTok{(seq_x, }\KeywordTok{mean}\NormalTok{(ITUB4_data$period.ret), }\KeywordTok{stdev}\NormalTok{(ITUB4_data$period.ret))}
\KeywordTok{plot}\NormalTok{(dens_PETR4$x, dens_PETR4$y, }\DataTypeTok{xlab =} \StringTok{"retorno PETR4"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"densidade"}\NormalTok{, }
    \DataTypeTok{type =} \StringTok{"l"}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(seq_x, norm_PETR4, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(dens_BVMF3$x, dens_BVMF3$y, }\DataTypeTok{xlab =} \StringTok{"retorno BVMF3"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"densidade"}\NormalTok{, }
    \DataTypeTok{type =} \StringTok{"l"}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(seq_x, norm_BVMF3, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(dens_ITUB4$x, dens_ITUB4$y, }\DataTypeTok{xlab =} \StringTok{"retorno ITUB4"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"densidade"}\NormalTok{, }
    \DataTypeTok{type =} \StringTok{"l"}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(seq_x, norm_ITUB4, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[h]

{\centering \includegraphics{coletando_dados_files/figure-latex/densidade-1} 

}

\caption{Densidade empírica dos ativos (linha sólida) e densidade normal (linha pontilhada)}\label{fig:densidade}
\end{figure}

Outra forma interessante de visualizar os dados é o gráfico de barras,
porém é necessário os preços de abertura e fechamento e o preço máximo e
preço mínimo, o que não está disponível na amostra utilizada.
Entretanto, podemos apresentar o grafico de média móvel dos preços. Par
aisso énecessário baixar o script \texttt{ma.R} que realiza a suavização
em
\url{http://faculty.chicagobooth.edu/ruey.tsay/teaching/introTS/ma.R}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{source}\NormalTok{(}\StringTok{"ma.R"}\NormalTok{)  }\CommentTok{# compila o script}
\NormalTok{preco_PETR4 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(PETR4_data$weighted.price)}
\NormalTok{preco_BVMF3 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(BVMF3_data$weighted.price)}
\NormalTok{preco_ITUB4 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(ITUB4_data$weighted.price)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{ma_PETR4 <-}\StringTok{ }\KeywordTok{ma}\NormalTok{(preco_PETR4, }\DecValTok{21}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{coletando_dados_files/figure-latex/media\%20movel-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ma_BVMF3 <-}\StringTok{ }\KeywordTok{ma}\NormalTok{(preco_BVMF3, }\DecValTok{21}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{coletando_dados_files/figure-latex/media\%20movel-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ma_ITUB4 <-}\StringTok{ }\KeywordTok{ma}\NormalTok{(preco_ITUB4, }\DecValTok{21}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{coletando_dados_files/figure-latex/media\%20movel-3.pdf}

FOram usadas 21 defasagens. O número de defasagens foi escolhido
arbitrariamente e remete à uma média de três dias anteriores, já que a
frequência de dados é por hora e o pregão fica aberto entre 10:00 hrs e
17:55 hrs.

Para encontrar a matriz de correlação do retorno dos ativos
primeiramente contruiremos uma matriz com os três retornos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matriz_retornos <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(PETR4_data$period.ret, BVMF3_data$period.ret, }
    \NormalTok{ITUB4_data$period.ret)}
\KeywordTok{cor}\NormalTok{(matriz_retornos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                       PETR4_data.period.ret BVMF3_data.period.ret
## PETR4_data.period.ret             1.0000000             0.3191739
## BVMF3_data.period.ret             0.3191739             1.0000000
## ITUB4_data.period.ret             0.4650334             0.3071115
##                       ITUB4_data.period.ret
## PETR4_data.period.ret             0.4650334
## BVMF3_data.period.ret             0.3071115
## ITUB4_data.period.ret             1.0000000
\end{verbatim}

\pagebreak

\section*{Referências}\label{referencias}
\addcontentsline{toc}{section}{Referências}

\setlength{\parindent}{0in}

\hypertarget{refs}{}
\hypertarget{ref-jarqueux5ftestux5f1987}{}
Jarque, Carlos M., and Anil K. Bera. 1987. ``A Test for Normality of
Observations and Regression Residuals.'' \emph{International Statistical
Review / Revue Internationale de Statistique} 55 (2): 163--72.
doi:\href{https://doi.org/10.2307/1403192}{10.2307/1403192}.

\hypertarget{ref-perlinux5fgethfdata:ux5f2016}{}
Perlin, Marcelo. 2016. \emph{GetHFData: Download and Aggregate High
Frequency Trading Data from Bovespa}.
\url{https://CRAN.R-project.org/package=GetHFData}.

\hypertarget{ref-perlinux5fgethfdata:ux5f2016-1}{}
Perlin, Marcelo, and Henrique Ramos. 2016. ``GetHFData: A R Package for
Downloading and Aggregating High Frequency Trading Data from Bovespa.''
SSRN Scholarly Paper ID 2824058. Rochester, NY: Social Science Research
Network. \url{https://papers.ssrn.com/abstract=2824058}.

\hypertarget{ref-ryanux5fquantmod:ux5f2016}{}
Ryan, Jeffrey A. 2016. \emph{Quantmod: Quantitative Financial Modelling
Framework}. \url{https://CRAN.R-project.org/package=quantmod}.

\hypertarget{ref-tsayux5fintroductionux5f2012}{}
Tsay, Ruey S. 2012. \emph{An Introduction to Analysis of Financial Data
with R}. 1 edition. Hoboken, N.J: Wiley.

\end{document}
